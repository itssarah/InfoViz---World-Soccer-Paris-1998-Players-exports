<html>
  <head>
    <title>Formes</title>
    <script src="./ressources/d3.v3.min.js"></script>
    <script src="https://d3js.org/d3.v4.js"></script>
    <style>
      body {
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .links line {
        stroke: #999;
        stroke-opacity: 0.6;
      }

      .nodes circle {
        stroke: #fff;
        stroke-width: 1.5px;
      }

      text {
        font-family: sans-serif;
        font-size: 10px;
      }
    </style>
  </head>

  <svg id="viz" width="960" height="600"></svg>
  <script>
    var svg = d3.select("svg"),
      width = +svg.attr("width"),
      height = +svg.attr("height");

    var color = d3.scaleOrdinal(d3.schemeCategory20);

    var width = 960;
    var height = 600;

    d3.csv("football.net.txt", function (data) {
      data = JSON.stringify(data);
      data = JSON.parse(data);

      var nodes = data.slice(0, 35).map(function (d) {
        console.log(d["*Vertices     35"].split(/\s+/));
        return {
          id: d["*Vertices     35"].split(/\s+/)[1],
          group: 1,
          name: d["*Vertices     35"].split(/\s+/)[2],
          x: d["*Vertices     35"].split(/\s+/)[3],
          y: d["*Vertices     35"].split(/\s+/)[4],
          r: d["*Vertices     35"].split(/\s+/)[5],
        };
      });

      var links = data.slice(36, 153).map(function (d) {
        return {
          source: d["*Vertices     35"].split(/\s+/)[1],
          target: d["*Vertices     35"].split(/\s+/)[2],
          value: d["*Vertices     35"].split(/\s+/)[3],
        };
      });

      data = { nodes, links };
      console.log(data);

      var link = svg
        .append("g")
        .attr("class", "links")
        .selectAll("line")
        .data(data.links)
        .enter()
        .append("line")
        .attr("stroke-width", function (d) {
          return Math.sqrt(d.value);
        });

      var node = svg
        .append("g")
        .attr("class", "nodes")
        .selectAll("g")
        .data(data.nodes)
        .enter()
        .append("g");

      var circles = node
        .append("circle")
        .attr("r", function (d) {
          return parseFloat(d.r) * 12;
        })
        .attr("cx", function (d) {
          return parseFloat(scale(d.x, 0, 1, 0, 960));
        })
        .attr("cy", function (d) {
          return parseFloat(scale(d.y, 0, 1, 0, 600));
        })
        .attr("fill", function (d) {
          return color(d.group);
        });

      function scale(number, inMin, inMax, outMin, outMax) {
        return (
          ((number - inMin) * (outMax - outMin)) / (inMax - inMin) + outMin
        );
      }

      var lables = node
        .append("text")
        .text(function (d) {
          return d.name;
        })
        .attr("x", function (d) {
          return parseFloat(scale(d.x, 0, 1, 0, 960) + 8);
        })
        .attr("y", function (d) {
          return parseFloat(scale(d.y, 0, 1, 0, 600));
        });

      node.append("title").text(function (d) {
        return d.id;
      });
    });
  </script>
</html>
